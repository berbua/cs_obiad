// Simple Clippy.js wrapper for agents
(function() {
  window.clippy = {
    agents: {},
    
    load: function(name, callback) {
      var BASE_PATH = '/agents/';
      var agent = new Agent(BASE_PATH + name + '/', name);
      
      agent.load(function() {
        window.clippy.agents[name] = agent;
        if (callback) callback(agent);
      });
    }
  };
  
  function Agent(path, name) {
    this.path = path;
    this.name = name;
    this._data = null;
    this._el = null;
    this._animator = null;
    this._balloon = null;
    this._queue = [];
    this._isLoaded = false;
  }
  
  Agent.prototype.load = function(callback) {
    var self = this;
    
    $.getScript(this.path + 'agent.js', function() {
      self._data = window[self.name + 'AgentData'];
      self._setupElement();
      self._isLoaded = true;
      
      // Load sounds
      $.getScript(self.path + 'sounds-mp3.js', function() {
        if (callback) callback();
      });
    });
  };
  
  Agent.prototype._setupElement = function() {
    this._el = $('<div class="clippy-agent"></div>');
    this._el.css({
      position: 'fixed',
      bottom: '10px',
      right: '10px',
      width: '124px',
      height: '93px',
      backgroundImage: 'url(' + this.path + 'map.png)',
      backgroundRepeat: 'no-repeat',
      zIndex: 10000,
      cursor: 'pointer'
    });
    
    this._balloon = $('<div class="clippy-balloon"></div>');
    this._balloon.css({
      position: 'fixed',
      bottom: '110px',
      right: '10px',
      backgroundColor: '#FFFFCC',
      border: '2px solid #000',
      borderRadius: '5px',
      padding: '10px',
      maxWidth: '200px',
      display: 'none',
      zIndex: 10001,
      fontFamily: 'Comic Sans MS, cursive',
      fontSize: '12px',
      boxShadow: '2px 2px 5px rgba(0,0,0,0.3)'
    });
    
    // Random messages when clicked
    var messages = [
      'Hej! KliknÄ…Å‚eÅ› mnie! ğŸ“',
      'Witaj! Czy wiesz, Å¼e jestem klasycznym asystentem z MS Office? ğŸ“',
      'PamiÄ™tasz mnie z lat 90? Te czasy byÅ‚y wspaniaÅ‚e! ğŸŒŸ',
      'Potrzebujesz pomocy z czymÅ›? A moÅ¼e po prostu obiad? ğŸ•',
      'Jestem tu Å¼eby pomÃ³c! Albo przynajmniej siÄ™ staraÄ‡... ğŸ˜…',
      'Czy zapisaÅ‚eÅ› siÄ™ juÅ¼ na obiad? To waÅ¼ne! ğŸ”',
      'Kliknij przycisk z muzykÄ… - Nokia Tune to klasyka! ğŸµ',
      'PamiÄ™taj Å¼eby daÄ‡ lajka swoim kolegom! ğŸ‘',
      'Netscape Navigator 4.0 - to byÅ‚y czasy! ğŸŒ',
      'LubiÄ™ tÄ™ stronÄ™! Ma klimat vintage! âœ¨',
      'Czy prÃ³bowaÅ‚eÅ› juÅ¼ wszystkich funkcji? ğŸ¤”',
      'Jestem twÃ³j przyjaciel i asystentem! ğŸ¤',
      'Comic Sans to najlepszy font! Fight me! ğŸ˜¤',
      'WordArt + GIF-y = perfection! ğŸ’¯',
      'Czasami tÄ™skniÄ™ za Windows 98... ğŸ’™',
      'MiÄ™dzy nami - pilnujÄ™ teÅ¼ bezpieczeÅ„stwa! ğŸ”’',
      'PrÃ³bowaÅ‚eÅ› wpisaÄ‡ <script>? Nice try! ğŸ˜',
      'Jestem jak firewall, tylko przyjemniejszy! ğŸ›¡ï¸',
      'Hakerzy mnie nie lubiÄ…, ale ja ich pilnujÄ™! ğŸ‘€',
      'BezpieczeÅ„stwo to moja druga pasja po obiadach! ğŸš¨'
    ];
    
    var self = this;
    this._el.click(function() {
      var randomMessage = messages[Math.floor(Math.random() * messages.length)];
      self.speak(randomMessage);
      self.play('GetAttention');
    });
    
    $('body').append(this._el);
    $('body').append(this._balloon);
    
    this._currentFrame = 0;
    this._currentAnimation = null;
  };
  
  Agent.prototype.show = function() {
    if (this._el) {
      this._el.show();
    }
  };
  
  Agent.prototype.hide = function() {
    if (this._el) {
      this._el.hide();
    }
    if (this._balloon) {
      this._balloon.hide();
    }
  };
  
  Agent.prototype.speak = function(text) {
    var self = this;
    if (this._balloon) {
      this._balloon.text(text);
      this._balloon.fadeIn(300);
      
      setTimeout(function() {
        self._balloon.fadeOut(300);
      }, 3000 + (text.length * 30));
    }
  };
  
  Agent.prototype.play = function(animationName) {
    if (!this._el) return;
    
    var self = this;
    
    // Remove any existing animation classes
    this._el.removeClass(function(index, className) {
      return (className.match(/\bclippy-animate-\S+/g) || []).join(' ');
    });
    
    // Add the new animation class
    var animClass = 'clippy-animate-' + animationName.toLowerCase();
    this._el.addClass(animClass);
    
    // Remove the class after animation completes
    setTimeout(function() {
      self._el.removeClass(animClass);
    }, 1000);
  };
  
  Agent.prototype.animate = function() {
    return this.play.apply(this, arguments);
  };
})();
